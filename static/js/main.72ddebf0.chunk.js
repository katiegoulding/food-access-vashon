(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{309:function(e,t,a){e.exports=a.p+"static/media/bucktemplateprintpage.97cf9a86.jpg"},324:function(e,t,a){e.exports=a(594)},329:function(e,t,a){},330:function(e,t,a){},594:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(82),l=a.n(o),s=(a(329),a(19)),c=a(20),i=a(22),u=a(21),d=a(23),h=(a(330),a(617)),m=a(623),p=a(622),f={routes:{barrier:"/barrier",createAccount:"/signup",accountRecovery:"/recover",base:"/",dash:{base:"/dash",viewData:"/dash/ViewData",createBucks:"/dash/CreateBucks",bucksLanding:"/dash/BucksLanding",viewBucks:"/dash/ViewBucks",scan:"/dash/Scan",manageAccount:"/dash/manage",editAccount:"/dash/manage/edit",formSuccess:"/dash/formSuccess",farmerPayout:"/dash/farmerPayout"}},variables:{colors:{bodyBG:"#EFF0F3"}}},v=a(10),g=a.n(v),b=(a(35),a(36),a(606)),E=a(603),y=a(618),k=a(613),C=a(609),w=a(614),S=a(605),O=a(75),j=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).handleOnUpdate=function(e,t){var n=t.width;return a.setState({width:n})},a.state={email:"",pw:"",role:"",errorMessage:void 0,loading:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.authUnsub=g.a.auth().onAuthStateChanged(function(t){t&&t.getIdTokenResult().then(function(t){console.log(t.claims.role),t.claims.role?e.props.history.push(f.routes.dash.base):e.props.history.push(f.routes.barrier)})})}},{key:"componentWillUnmount",value:function(){this.authUnsub()}},{key:"handleSignIn",value:function(e){var t=this;e.preventDefault(),this.setState({loading:!0}),g.a.auth().signInWithEmailAndPassword(this.state.email,this.state.pw).catch(function(e){return t.setState({errorMessage:e.message,loading:!1})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,n=t.errorMessage,o=this.state.width>=E.a.onlyTablet.minWidth?"6":"12";return r.a.createElement(E.a,{as:y.a,fireOnMount:!0,onUpdate:this.handleOnUpdate,centered:"true",middle:!0,columns:1},r.a.createElement(y.a.Column,{width:o,verticalAlign:"middle",textAlign:"left"},r.a.createElement(k.a,{attached:"top",header:"Welcome to our site!",content:"Sign in to access your account"}),r.a.createElement(C.a,{className:"attached fluid segment",onSubmit:function(t){return e.handleSignIn(t)},error:n,loading:a},r.a.createElement(k.a,{error:!0,header:n,content:"not logged in"}),r.a.createElement(C.a.Input,{required:!0,id:"email",label:"Email",placeholder:"Email",type:"email",value:this.state.email,onInput:function(t){return e.setState({email:t.target.value})}}),r.a.createElement(C.a.Input,{required:!0,id:"pw",label:"Password",placeholder:"Password",type:"password",value:this.state.pw,onInput:function(t){return e.setState({pw:t.target.value})}}),r.a.createElement(w.a,{type:"submit"},"Sign In"),r.a.createElement(S.a,{hidden:!0}),r.a.createElement(b.a,{to:f.routes.accountRecovery},"Forgot password?")),r.a.createElement(k.a,{attached:"bottom",info:!0},r.a.createElement(O.a,{name:"help"}),"Don't have an account? \xa0",r.a.createElement(b.a,{to:f.routes.createAccount},"Sign Up"),"\xa0instead.")))}}]),t}(r.a.Component),A=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).handleOnUpdate=function(e,t){var n=t.width;return a.setState({width:n})},a.state={firstName:"",lastName:"",role:"",org:"",email:"",pw:"",pw_confirm:"",errorMessage:void 0},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.authUnsub=g.a.auth().onAuthStateChanged(function(t){t&&t.getIdTokenResult().then(function(t){console.log(t.claims.role),t.claims.role?e.props.history.push(f.routes.dash.base):e.props.history.push(f.routes.barrier)})})}},{key:"handleCreateAccount",value:function(e){var t=this;if(e.preventDefault(),this.setState({loading:!0}),"admin"!==this.state.role.toLowerCase()&&"bookkeeper"!==this.state.role.toLowerCase()||this.setState({org:"fap"}),this.state.pw!==this.state.pw_confirm)this.setState({errorMessage:"Passwords do not match",loading:!1});else{if(""===this.state.displayName)return void this.setState({errorMessage:"Enter Display Name",loading:!1});if(this.state.pw.length<6)return void this.setState({errorMessage:"Password must be at least six characters",loading:!1});g.a.auth().createUserWithEmailAndPassword(this.state.email,this.state.pw).then(function(e){try{return t.setState({loading:!0,errorMessage:""}),console.log("response = ",e),g.a.database().ref("/users/".concat(e.user.uid)).set({firstName:t.state.firstName,lastName:t.state.lastName,email:t.state.email,role:t.state.role,org:t.state.org,vouchersList:[],approved:!1})}catch(a){return console.log("err on write to db = ",a),t.setState({loading:!1,errorMessage:a.message})}}).catch(function(e){console.log("err on write to db = ",e),t.setState({loading:!1,errorMessage:e.message})})}}},{key:"render",value:function(){var e=this,t=[{key:"f",text:"Food Bank",value:"Foodbank"},{key:"d",text:"DoVE",value:"dove"},{key:"c",text:"Vashon Community Care",value:"vcc"},{key:"s",text:"Senior Center",value:"seniorcenter"},{key:"i",text:"Interfaith Council to Prevent Homelessness",value:"interfaith"},{key:"h",text:"Vashon Household",value:"vashonhousehold"},{key:"l",text:"La Comunidad",value:"lacomunidad"},{key:"y",text:"Vashon Youth and Family Services",value:"vyfs"}],a=this.state,n=a.loading,o=a.errorMessage,l=a.role,s=this.state.width>=E.a.onlyTablet.minWidth?"6":"12";return r.a.createElement(E.a,{as:y.a,fireOnMount:!0,onUpdate:this.handleOnUpdate,centered:"true",middle:!0,columns:1},r.a.createElement(y.a.Column,{width:s,verticalAlign:"middle",textAlign:"left"},r.a.createElement(k.a,{attached:!0,header:"Create an Account",content:"Provide some basic information to get started!"}),r.a.createElement(C.a,{className:"attached fluid segment",onSubmit:function(t){return e.handleCreateAccount(t)},error:o,loading:n},r.a.createElement(k.a,{error:!0,header:"Account not created",content:o}),r.a.createElement(C.a.Input,{required:!0,label:"First Name",htmlFor:"firstName",id:"firstName",type:"text",className:"form-control",value:this.state.firstName,onInput:function(t){return e.setState({firstName:t.target.value})}}),r.a.createElement(C.a.Input,{required:!0,label:"Last Name",htmlFor:"lastName",id:"lastName",type:"text",className:"form-control",value:this.state.lastName,onInput:function(t){return e.setState({lastName:t.target.value})}}),r.a.createElement(C.a.Select,{required:!0,label:"Role",htmlFor:"role",value:this.state.role,options:[{key:"f",text:"Farmer",value:"Farmer"},{key:"c",text:"Caseworker",value:"Caseworker"},{key:"a",text:"Admin",value:"Admin"},{key:"b",text:"Bookkeeper",value:"Bookkeeper"}],onChange:function(t,a){e.setState({role:a.value})}}),function(){switch(l){case"Caseworker":return r.a.createElement(C.a.Select,{required:!0,label:"Affiliated Organization:",htmlFor:"organization",value:e.state.org,options:t,onChange:function(t,a){e.setState({org:a.value})}});case"Farmer":return r.a.createElement(C.a.Input,{required:!0,label:"Farm Name:",htmlFor:"organization",value:e.state.org,onInput:function(t){return e.setState({org:t.target.value})}});case"Admin":case"Bookkeeper":return r.a.createElement(C.a.Input,{label:"Affiliated Organization:",htmlFor:"organization",value:"Food Access Partnership",placeholder:"Food Access Partnership",readOnly:!0});default:return r.a.createElement("div",null)}}(),r.a.createElement(C.a.Input,{required:!0,id:"email",htmlFor:"email",label:"Email",type:"email",placeholder:"Enter your email address",value:this.state.email,onInput:function(t){return e.setState({email:t.target.value})}}),r.a.createElement(C.a.Input,{required:!0,id:"pw",htmlFor:"password",label:"Password",type:"password",placeholder:"Enter your password",value:this.state.pw,onInput:function(t){return e.setState({pw:t.target.value})}}),r.a.createElement(C.a.Input,{required:!0,id:"pw_confrim",htmlFor:"passwordConfirm",label:"Reenter Password",type:"password",placeholder:"confirm your password",value:this.state.pw_confirm,onInput:function(t){return e.setState({pw_confirm:t.target.value})}}),r.a.createElement(w.a,{type:"submit"},"Create Account")),r.a.createElement(k.a,{attached:"bottom",info:!0},r.a.createElement(O.a,{name:"help"}),"Already have an account? \xa0",r.a.createElement(b.a,{to:f.routes.base},"Sign in!"),"\xa0")))}}]),t}(r.a.Component),I=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).handleOnUpdate=function(e,t){var n=t.width;return a.setState({width:n})},a.state={email:"",errorMessage:!1,successMessage:void 0},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.authUnsub=g.a.auth().onAuthStateChanged(function(t){e.setState({currentUser:t})})}},{key:"componentWillUnmount",value:function(){this.authUnsub()}},{key:"handlePasswordReset",value:function(e){var t=this,a=g.a.auth();this.setState({errorMessage:void 0}),a.sendPasswordResetEmail(this.state.email).then(this.setState({successMessage:!0,email:""})).catch(function(e){return t.setState({errorMessage:e.message})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.width,n=t.successMessage,o=(t.email,a>=E.a.onlyTablet.minWidth?"6":"12");return r.a.createElement(E.a,{as:y.a,fireOnMount:!0,onUpdate:this.handleOnUpdate,centered:"true",middle:!0,columns:1},r.a.createElement(y.a.Column,{width:o,verticalAlign:"middle",textAlign:"left"},r.a.createElement(k.a,{attached:"top",header:"Account Recovery",content:"Enter your account email to reset your password."}),r.a.createElement(C.a,{className:"attached fluid segment",onSubmit:function(t){return e.handlePasswordReset(t)},warning:n},r.a.createElement(C.a.Input,{required:!0,id:"email",label:"Email",type:"email",placeholder:"Enter your email address",value:this.state.email,onInput:function(t){return e.setState({email:t.target.value})}}),r.a.createElement(w.a,{type:"submit",content:"Reset"}),r.a.createElement(k.a,{warning:!0,header:"Thank you",content:"If that account exists in our system, password reset steps will be sent"}))))}}]),t}(r.a.Component),B=a(48),x=a(199),D=a.n(x),M=a(612),N=a(620),U=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={role:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handlePurge",value:function(){D.a.functions().httpsCallable("deleteUser")({email:this.props.acctSnapshot.val().email}).then(function(e){console.log(e)}),this.props.acctRef.child(this.props.acctSnapshot.key).remove()}},{key:"handleApprove",value:function(){var e=this.props.acctSnapshot.val();this.props.acctRef.child(this.props.acctSnapshot.key).update({approved:!0}),D.a.functions().httpsCallable("changeRole")({email:e.email,role:e.role}).then(function(e){console.log(e)})}},{key:"render",value:function(){var e,t=this,a=this.props.acctSnapshot.val();return e=a.approved?r.a.createElement(M.a.Cell,null,r.a.createElement(O.a,{name:"checkmark"}),"Approved"):r.a.createElement(M.a.Cell,null,r.a.createElement(O.a,{name:"attention"}),"Requires Approval"),r.a.createElement(M.a.Row,{warning:!a.approved},r.a.createElement(M.a.Cell,null,r.a.createElement(N.a,{as:"h4"},r.a.createElement(N.a.Content,null,a.firstName," ",a.lastName,r.a.createElement(N.a.Subheader,null,a.org)))),r.a.createElement(M.a.Cell,null,a.role),r.a.createElement(M.a.Cell,null,a.email),e,r.a.createElement(M.a.Cell,{textAlign:"center"},a.approved?null:r.a.createElement(w.a.Group,null,r.a.createElement(w.a,{size:"mini",positive:!0,content:"Approve",onClick:function(){return t.handleApprove()}}),r.a.createElement(w.a,{size:"mini",content:"Reject",onClick:function(){return t.handlePurge()}}))),r.a.createElement(M.a.Cell,{textAlign:"center"},r.a.createElement(O.a,{name:"delete",className:"delete",size:"large",onClick:function(){return t.handlePurge()}})))}}]),t}(r.a.Component),P=a(624),R=a(619),L=a(607),F=a(608),V=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={accountSnapshot:void 0},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.props.accountRef.off("value",this.unlisten),this.unlisten=e.accountRef.on("value",function(e){return t.setState({accountSnapshot:e})})}},{key:"componentDidMount",value:function(){var e=this;this.unlisten=this.props.accountRef.on("value",function(t){return e.setState({accountSnapshot:t})})}},{key:"componentWillUnmount",value:function(){this.props.accountRef.off("value",this.unlisten)}},{key:"render",value:function(){var e=this;if(!this.state.accountSnapshot)return r.a.createElement("div",null,r.a.createElement(P.a,null,r.a.createElement(R.a,{active:!0,inverted:!0},r.a.createElement(L.a,{indeterminate:!0},"Loading Accounts"))));var t=[];return this.state.accountSnapshot.forEach(function(a){e.props.user.email!==a.val().email&&t.push(r.a.createElement(U,{key:a.key,acctSnapshot:a,acctRef:e.props.accountRef}))}),r.a.createElement(F.a,null,r.a.createElement(M.a,{singleLine:!0,stackable:!0,selectable:!0},r.a.createElement(M.a.Header,null,r.a.createElement(M.a.Row,null,r.a.createElement(M.a.HeaderCell,null,"Name"),r.a.createElement(M.a.HeaderCell,null,"Role"),r.a.createElement(M.a.HeaderCell,null,"Email"),r.a.createElement(M.a.HeaderCell,null,"Approval Status"),r.a.createElement(M.a.HeaderCell,{textAlign:"center"},"Actions"),r.a.createElement(M.a.HeaderCell,{textAlign:"center"},"Delete Account"))),r.a.createElement(M.a.Body,null,t)))}}]),t}(r.a.Component),z=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={value:"",filter:"",name:"",org:"",role:"",date_added:"",errorMessage:void 0},a.handleChange=a.handleChange.bind(Object(B.a)(Object(B.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.authUnsub=g.a.auth().onAuthStateChanged(function(t){e.setState({currentUser:t}),null===e.state.currentUser&&e.props.history.push(f.routes.base)})}},{key:"componentWillUnmount",value:function(){this.authUnsub()}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var e=g.a.database().ref("/users/");return r.a.createElement(F.a,null,r.a.createElement(P.a,{style:{paddingTop:"30px",paddingRight:"40px",paddingLeft:"40px"},raised:!0},r.a.createElement(F.a,null,r.a.createElement(V,{user:this.state.currentUser,accountRef:e}))))}}]),t}(r.a.Component),T=(r.a.Component,a(611)),H=a(610),W=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).showView=function(){return a.setState({viewModalOpen:!0})},a.showDelete=function(){return a.setState({deleteModalOpen:!0})},a.close=function(){return a.setState({deleteModalOpen:!1,viewModalOpen:!1})},a.deleteBuckSet=function(){var e=a.props.data.title;""!=e&&g.a.database().ref("buckSets/"+e).remove().then(function(){console.log("Remove succeeded."),a.setState({deleteModalOpen:!1})}).catch(function(e){console.log("Remove failed: "+e.message)})},a.viewBuckSet=function(){},a.state={viewModalOpen:!1,deleteModalOpen:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.data,a=t.title,n=t.subtitle;this.state.open;return r.a.createElement(T.a,{fluid:!0},r.a.createElement(T.a.Content,null,r.a.createElement(T.a.Header,null,a),r.a.createElement(T.a.Meta,null,n)),r.a.createElement(T.a.Content,{extra:!0},r.a.createElement(H.a,{trigger:r.a.createElement(w.a,{primary:!0,content:"View"}),size:"small",open:this.viewModalOpen,onClose:this.close,closeIcon:!0},r.a.createElement(H.a.Header,null,'"',a,'" Buck Set'),r.a.createElement(H.a.Content,null,r.a.createElement("p",null,"Created by ",n),r.a.createElement("p",null,"More information about the selected buck set"))),r.a.createElement(H.a,{trigger:r.a.createElement(w.a,{icon:"trash"}),size:"mini",open:this.deleteModalOpen,onClose:this.close,closeIcon:!0},r.a.createElement(H.a.Header,null,'Are you sure you want to delete "',a,'" Buck Set?'),r.a.createElement(H.a.Content,null,r.a.createElement("p",null,"Doing so will mark all VIGA bucks generated for this set as inactive")),r.a.createElement(H.a.Actions,null,r.a.createElement(w.a,{color:"red",onClick:function(){return e.deleteBuckSet()},content:"Delete"})))))}}]),t}(r.a.Component),q=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={firebaseBuckSet:[]},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=[],a=g.a.database().ref("buckSets");a.orderByChild("createdOn").on("child_added",function(a){var n=a.val();t.push({title:n.name,subtitle:n.createdBy}),e.setState({firebaseBuckSet:t})}),a.orderByChild("createdOn").on("child_removed",function(a){var n=a.val();t=t.filter(function(e){return!(e.title===n.name&&e.subtitle===n.createdBy)}),e.setState({firebaseBuckSet:t})})}},{key:"render",value:function(){return r.a.createElement(y.a.Column,{width:6},r.a.createElement(F.a,null,r.a.createElement(N.a,{as:"h2"},"Existing Buck Sets"),r.a.createElement(T.a.Group,null,this.state.firebaseBuckSet.map(function(e){return r.a.createElement(W,{key:e.title+e.subtitle,data:e})}))))}}]),t}(r.a.Component),Y=a(39),G=a(100),$=a.n(G),_=a(200),J=(a(282),a(616)),K=(a(562),a(309)),Q=a.n(K),X=a(201),Z=a.n(X),ee=a(310),te=a.n(ee);Z.a.vfs=te.a.pdfMake.vfs;var ae=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).validateFormData=function(){var e=Object(_.a)($.a.mark(function e(t){var n,r,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<=0)){e.next=3;break}return a.setState({errorMessage:"Sum of vouchers in form must be greater than zero."}),e.abrupt("return",!1);case 3:return n=a.props.buckSetName,r=g.a.database().ref("buckSets"),o=!0,e.next=8,r.orderByChild("name").equalTo(n).once("value",function(e){e.forEach(function(e){e.key;e.val().name==n&&(a.setState({errorMessage:"The buck set name you used already exists."}),o=!1)})});case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleSubmit=function(){var e=Object(_.a)($.a.mark(function e(t){var n,r,o,l,s,c,i,u,d,h,m,p;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=a.props,r=n.doveCount,o=n.vyfsCount,l=n.lacomunidadCount,s=n.vashonhouseholdCount,a.setState({loading:!0}),c=r+o+l+s,e.next=6,a.validateFormData(c);case 6:if(e.sent){e.next=12;break}return a.setState({loading:!1}),e.abrupt("return");case 12:a.setState({errorMessage:""});case 13:g.a.database().ref().child("buckSets/"+a.props.buckSetName).update({name:a.props.buckSetName,createdOn:new String(new Date),createdBy:a.props.username,year:a.props.validYear,doveCount:a.props.doveCount,vyfsCount:a.props.vyfsCount,lacomunidadCount:a.props.lacomunidadCount,vashonhouseholdCount:a.props.vashonhouseholdCount}).then(function(e){console.log("Buckset upload passed")}).catch(function(e){console.log("Buckset upload failed with: ",e)}),i=[],u=a.postVoucherData("dove",r,i),d=a.postVoucherData("vyfs",o,i),h=a.postVoucherData("lacomunidad",l,i),m=a.postVoucherData("vashonhousehold",s,i),p={Year:a.props.validYear,ids:i},Promise.all([u,d,h,m]).then(function(e){var t=a.createPDF(p);a.toDataURL(Q.a,function(e){t.background=[{image:e,width:612,height:792}],console.log(JSON.stringify(t)),Z.a.createPdf(t).download(a.props.buckSetName+".pdf",function(){a.setState({complete:!0,loading:!1,errorMessage:""}),(0,a.props.toggleShowCreateBucks)()})})}).catch(function(e){console.log("Error on firebase request",e),a.setState({errorMessage:"Error on firebase request"})}),console.log("firebase.functions() = ",g.a.functions());case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.state={loading:!1,complete:!1,hasError:!1,errorMessage:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"toDataURL",value:function(e,t,a){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){var e,n=document.createElement("CANVAS"),r=n.getContext("2d");n.height=this.naturalHeight,n.width=this.naturalWidth,r.drawImage(this,0,0),e=n.toDataURL(a),t(e)},n.src=e,(n.complete||void 0===n.complete)&&(n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",n.src=e)}},{key:"createPDF",value:function(e){var t=e.ids,a=(e.year,{content:[]});a.content.pageSize="LETTER";var n=1;return t.forEach(function(e){console.log(e);e.partnerOrg;var r,o=e.id;r=n%4==0&&n!==t.length?{qr:o,fit:50,margin:[381,0,0,137],pageBreak:"after"}:n%4==1?{qr:o,fit:50,margin:[381,51,0,137]}:{qr:o,fit:50,margin:[381,0,0,137]},console.log(JSON.stringify(r)),a.content.push(r),n++}),a.pageMargins=[0,0,0,0],a}},{key:"postVoucherData",value:function(e,t,a){for(var n={},r=0;r<t;r++){var o={organization:e,createdOn:new String(new Date),year:this.props.validYear},l=g.a.database().ref().child("vouchers").push().key;a.push({partnerOrg:e,id:l}),g.a.database().ref().child("vis2/"+e+"/created/").update(Object(Y.a)({},l,new Date)),n["/vouchers/"+l]=o}return g.a.database().ref().update(n)}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,n=t.errorMessage,o=this.props.doveCount+this.props.vyfsCount+this.props.lacomunidadCount+this.props.vashonhouseholdCount;return r.a.createElement(y.a.Column,{width:10},r.a.createElement(P.a,{raised:!0},r.a.createElement(C.a,{onSubmit:this.handleSubmit,loading:a,error:n},r.a.createElement(C.a.Input,{required:!0,fluid:!0,transparent:!0,size:"huge",placeholder:"Buck Set Name",value:this.props.buckSetName,onInput:function(t){return e.props.handleChange({buckSetName:t.target.value})}}),r.a.createElement(N.a,{as:"h5",color:"grey",textAlign:"left"},"BUCK ALLOCATION"),r.a.createElement(C.a.Input,{required:!0,fluid:!0,label:"Expiration Date",placeholder:"ie: 2018",type:"date",value:this.props.validYear,onInput:function(t){return e.props.handleChange({validYear:t.target.value})}}),r.a.createElement(C.a.Input,{fluid:!0,label:"VYFS",placeholder:0,type:"number",onInput:function(t){return e.props.handleChange({vyfsCount:Number(t.target.value)})},min:0}),r.a.createElement(C.a.Input,{fluid:!0,label:"La Communidad",placeholder:0,type:"number",onInput:function(t){return e.props.handleChange({lacomunidadCount:Number(t.target.value)})},min:0}),r.a.createElement(C.a.Input,{fluid:!0,label:"Vashon Household",placeholder:0,type:"number",onInput:function(t){return e.props.handleChange({vashonhouseholdCount:Number(t.target.value)})},min:0}),r.a.createElement(S.a,{hidden:!0}),r.a.createElement(J.a.Group,{widths:"two"},r.a.createElement(J.a,null,r.a.createElement(J.a.Value,null,1*o),r.a.createElement(J.a.Label,null,"VIGA Bucks")),r.a.createElement(J.a,null,r.a.createElement(J.a.Value,null,"$",2*o,".00"),r.a.createElement(J.a.Label,null,"Dollars"))),r.a.createElement(S.a,{hidden:!0}),r.a.createElement(w.a,{color:"blue"},"Generate Set"),r.a.createElement(k.a,{error:!0,header:n,content:"form not submitted"}))))}}]),t}(r.a.Component),ne=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.doveCount+this.props.vyfsCount+this.props.lacomunidadCount+this.props.vashonhouseholdCount;return r.a.createElement(y.a.Column,{width:10},r.a.createElement(P.a,{raised:!0,style:{"padding-top":"30px","padding-right":"40px","padding-left":"40px"}},r.a.createElement(N.a,{as:"h1",textAlign:"left"},"Success!",r.a.createElement(N.a.Subheader,null,'"',this.props.buckSetName,'" Buck Set Created')),r.a.createElement(N.a,{as:"h5",color:"grey",textAlign:"left"},"BUCK ALLOCATION"),r.a.createElement("table",{class:"ui very basic table"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Dove"),r.a.createElement("td",null,this.props.doveCount," bucks"),r.a.createElement("td",null,"$",2*this.props.doveCount,".00")),r.a.createElement("tr",null,r.a.createElement("td",null,"VYFS: LatinX"),r.a.createElement("td",null,this.props.vyfsCount," bucks"),r.a.createElement("td",null,"$",2*this.props.vyfsCount,".00")),r.a.createElement("tr",null,r.a.createElement("td",null,"La Comunidad"),r.a.createElement("td",null,this.props.lacomunidadCount," bucks"),r.a.createElement("td",null,"$",2*this.props.lacomunidadCount,".00")),r.a.createElement("tr",null,r.a.createElement("td",null,"Vashon Household"),r.a.createElement("td",null,this.props.vashonhouseholdCount," bucks"),r.a.createElement("td",null,"$",2*this.props.vashonhouseholdCount,".00")))),r.a.createElement(N.a,{as:"h5",color:"grey",textAlign:"left"},"EXPIRATION DATE"),r.a.createElement("p",null,this.props.validYear),r.a.createElement(S.a,{hidden:!0}),r.a.createElement(J.a.Group,{widths:"two"},r.a.createElement(J.a,null,r.a.createElement(J.a.Value,null,1*e),r.a.createElement(J.a.Label,null,"VIGA Bucks")),r.a.createElement(J.a,null,r.a.createElement(J.a.Value,null,"$",2*e,".00"),r.a.createElement(J.a.Label,null,"Dollars"))),r.a.createElement(S.a,{hidden:!0}),r.a.createElement(w.a,{content:"Create New Buck Set"})))}}]),t}(r.a.Component),re=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={showCreateBucks:!0,buckSetName:"",doveCount:0,vyfsCount:0,lacomunidadCount:0,vashonhouseholdCount:0,validYear:""},a.handleChange=a.handleChange.bind(Object(B.a)(Object(B.a)(a))),a.toggleShowCreateBucks=a.toggleShowCreateBucks.bind(Object(B.a)(Object(B.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleChange",value:function(e){this.setState(e)}},{key:"toggleShowCreateBucks",value:function(e){this.setState({showCreateBucks:!this.state.showCreateBucks})}},{key:"toggleShowCreateBucks",value:function(e){this.setState({showCreateBucks:!this.state.showCreateBucks})}},{key:"render",value:function(){return r.a.createElement(F.a,null,r.a.createElement(y.a,{stackable:!0,centered:!0},r.a.createElement(y.a.Row,null,this.state.showCreateBucks?r.a.createElement(ae,{toggleShowCreateBucks:this.toggleShowCreateBucks,handleChange:this.handleChange,buckSetName:this.state.buckSetName,username:this.props.username,doveCount:this.state.doveCount,vyfsCount:this.state.vyfsCount,lacomunidadCount:this.state.lacomunidadCount,vashonhouseholdCount:this.state.vashonhouseholdCount,validYear:this.state.validYear}):r.a.createElement(ne,{toggleShowCreateBucks:this.toggleShowCreateBucks,buckSetName:this.state.buckSetName,doveCount:this.state.doveCount,vyfsCount:this.state.vyfsCount,lacomunidadCount:this.state.lacomunidadCount,vashonhouseholdCount:this.state.vashonhouseholdCount,validYear:this.state.validYear}),r.a.createElement(q,null))))}}]),t}(r.a.Component),oe=a(202),le=a.n(oe),se=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).handleScan=function(e){console.log(a.props.userId),e&&(console.log(e),a.isValid(e)?g.a.database().ref("vouchers/").child(e).once("value",function(t){if(t.exists()){console.log("This ID exists."),console.log(a.props.userId);var n=g.a.database().ref("vouchers/"+e),r=g.a.database().ref("users/"+a.props.userId),o=g.a.database().ref().child("vis1/"+a.props.userId),l=new Date;if(console.log("this is the uid passed from props",a.props.userId),console.log("this is the role passed from props",a.props.role),"farmer"===a.props.role)console.log("I am in the farmer scan section"),g.a.database().ref("vouchers/"+e+"/redeemedOn").on("value",function(e){console.log("snapshot.val() : ",e.val()),e.val()?console.log("this voucher has already been redeemed"):(console.log("this voucher has not been redeemed before"),n.update({redeemedOn:l}))}),r.child("vouchersList").update(Object(Y.a)({},e,"notPaid")),o.update(Object(Y.a)({},e,l)),g.a.database().ref("vouchers/"+e).once("value").then(function(t){var a=t.val().organization;g.a.database().ref().child("vis2/"+a+"/redeemed/").update(Object(Y.a)({},e,l))});else if("caseworker"===a.props.role){g.a.database().ref("vouchers/"+e+"/handedOutOn").on("value",function(e){e.val()?console.log("this voucher has already been handed out"):(console.log("this voucher has not been handed out before"),n.update({handedOutOn:new Date}))}),g.a.database().ref("vouchers/"+e).once("value").then(function(t){var a=t.val().organization;g.a.database().ref().child("vis2/"+a+"/handedOut/").update(Object(Y.a)({},e,l))}),r.child("vouchersList").update(Object(Y.a)({},e,"true"))}else console.log("you're currently an admin which does not support scanning");a.setState({invalidScan:!1})}else console.log("This ID doesn't exist."),a.setState({invalidScan:!0})}):(console.log("bad path"),a.setState({invalidScan:!0})),a.setState({result:e}))},a.handleError=function(e){console.error(e),a.setState({legacyMode:!0})},a.state={result:"No result",legacyMode:!1,invalidScan:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"isValid",value:function(e){return/[^.#$[\]]/.test(e)}},{key:"render",value:function(){var e;return e=this.state.legacyMode?r.a.createElement(le.a,{delay:300,onError:this.handleError,onScan:this.handleScan,style:{width:"50%",margin:"auto"},legacyMode:!0}):r.a.createElement(le.a,{delay:300,onError:this.handleError,onScan:this.handleScan,style:{width:"50%",margin:"auto"}}),r.a.createElement(F.a,null,r.a.createElement(P.a,{style:{paddingTop:"30px",paddingRight:"40px",paddingLeft:"40px"},raised:!0},this.state.invalidScan?r.a.createElement(k.a,{warning:!0},r.a.createElement(k.a.Header,null,"Invalid Scan!"),r.a.createElement("p",null,"Make sure you have a valid coupon, then try again.")):null,r.a.createElement(F.a,null,e,r.a.createElement("p",null,"Results: ",this.state.result))))}}]),t}(r.a.Component),ce=a(99),ie=a(148),ue=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).listenForUpdates=function(){g.a.database().ref("users").on("child_changed",function(e){a.loadPayoutRecords()})},a.loadPayoutRecords=function(){var e=[];g.a.database().ref("/users/").once("value",function(t){t.forEach(function(t){var a=t.val().role.toLowerCase(),n=t.val().approved.toString().toLowerCase(),r=0,o=0;if(t.val().vouchersList){var l=t.val().vouchersList;Object.keys(l).forEach(function(e){r++,"notpaid"===l[e].toLowerCase()&&o++})}"farmer"===a&&"true"===n&&e.push({name:t.val().firstName+" "+t.val().lastName,farmerUid:t.key,farm:t.val().org,email:t.val().email,totalBucks:r,bucksNotPaid:o})}),a.setState({farmerList:e})}),console.log("after set state, farmerList: ",e)},a.completePayout=function(e){console.log("farmerUid",e),g.a.database().ref("users/"+e+"/vouchersList").on("value",function(t){t.forEach(function(t){var a=t.key;console.log("key",a),g.a.database().ref("users/"+e+"/vouchersList").update(Object(Y.a)({},a,"paid"))})})},a.state={farmerList:[],paidUp:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.authUnsub=g.a.auth().onAuthStateChanged(function(t){e.setState({currentUser:t}),e.state.currentUser||e.props.history.push(f.routes.base)}),this.loadPayoutRecords(),this.listenForUpdates()}},{key:"componentWillUnmount",value:function(){this.authUnsub()}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var e=this,t=this.state.farmerList;return console.log("farmerList: ",t),r.a.createElement(F.a,null,r.a.createElement(P.a,{style:{paddingTop:"30px",paddingRight:"40px",paddingLeft:"40px"},raised:!0},r.a.createElement(F.a,null,r.a.createElement(M.a,{singleLine:!0,stackable:!0,selectable:!0},r.a.createElement(M.a.Header,null,r.a.createElement(M.a.Row,null,r.a.createElement(M.a.HeaderCell,null,"Name"),r.a.createElement(M.a.HeaderCell,null,"Farm"),r.a.createElement(M.a.HeaderCell,null,"Email"),r.a.createElement(M.a.HeaderCell,null,"Total Bucks Collected"),r.a.createElement(M.a.HeaderCell,{textAlign:"center"},"Outstanding Bucks"))),r.a.createElement(M.a.Body,null,t.map(function(t){return console.log("element: ",t),r.a.createElement(ce.a,null,r.a.createElement(M.a.Cell,null,t.name),r.a.createElement(M.a.Cell,null,t.farm),r.a.createElement(M.a.Cell,null,t.email),r.a.createElement(M.a.Cell,null,t.totalBucks),r.a.createElement(M.a.Cell,{textAlign:"center"},0===t.bucksNotPaid?r.a.createElement(w.a,{compact:!0,basic:!0,color:"green"},r.a.createElement(O.a,{color:"green",name:"checkmark",size:"small"}),"All Paid Up!"):r.a.createElement(w.a,{as:"div",labelPosition:"left"},r.a.createElement(ie.a,{basic:!0,as:"a",pointing:"right"},"$",2*t.bucksNotPaid,".00 / ",t.bucksNotPaid," Bucks"),r.a.createElement(w.a,{color:"green",icon:!0,onClick:function(){return e.completePayout(t.farmerUid)}},r.a.createElement(O.a,{name:"dollar sign"}),"Mark as Paid"))))}))))))}}]),t}(r.a.Component),de=a(615),he=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={chartData:e.chartData,firebaseDataArray:[]},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){if("farmer"===this.props.role)g.a.database().ref("viz1/"+this.props.uid);else if("admin"===this.props.role)g.a.database().ref("viz2");else if("caseworker"===this.props.role)g.a.database().ref("viz2/"+this.props.org)}},{key:"render",value:function(){return r.a.createElement(F.a,null)}}]),t}(r.a.Component),me=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(u.a)(t).call(this,e))).handleOnUpdate=function(e,t){var n=t.width;return a.setState({width:n})},a.handleSignOut=function(){g.a.auth().signOut().then(a.props.history.push(f.routes.base))},a.state={role:"",username:"",org:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"onSetSidebarOpen",value:function(e){}},{key:"mediaQueryChanged",value:function(){}},{key:"componentDidMount",value:function(){var e=this;this.authUnsub=g.a.auth().onAuthStateChanged(function(t){t?t.getIdTokenResult().then(function(a){console.log("role: ",a.claims.role),"caseworker"===a.claims.role?e.setState({username:t.email,uid:t.uid,role:a.claims.role,org:e.state.org}):e.setState({username:t.email,uid:t.uid,role:a.claims.role})}):e.props.history.push(f.routes.base)})}},{key:"render",value:function(){var e,t,a,n,o=this,l=[r.a.createElement(de.a.Item,{name:"Scan",as:b.a,to:f.routes.dash.base,active:this.props.location.pathname===f.routes.dash.base}),r.a.createElement(de.a.Item,{name:"View Data",as:b.a,to:f.routes.dash.viewData,active:this.props.location.pathname===f.routes.dash.viewData})],s=[r.a.createElement(de.a.Item,{name:"Scan",as:b.a,to:f.routes.dash.base,active:this.props.location.pathname===f.routes.dash.base}),r.a.createElement(de.a.Item,{name:"View Data",as:b.a,to:f.routes.dash.viewData,active:this.props.location.pathname===f.routes.dash.viewData})],c=[r.a.createElement(de.a.Item,{name:"Create Bucks",as:b.a,to:f.routes.dash.bucksLanding,active:this.props.location.pathname===f.routes.dash.bucksLanding}),r.a.createElement(de.a.Item,{name:"Manage Accounts",as:b.a,to:f.routes.dash.manageAccount,active:this.props.location.pathname===f.routes.dash.manageAccount}),r.a.createElement(de.a.Item,{name:"View Data",as:b.a,to:f.routes.dash.viewData,active:this.props.location.pathname===f.routes.dash.viewData})],i=[r.a.createElement(de.a.Item,{name:"Farmer Payout",as:b.a,to:f.routes.dash.farmerPayout,active:this.props.location.pathname===f.routes.dash.farmerPayout})],u=[r.a.createElement(p.a,{exact:!0,path:f.routes.dash.base,render:function(){return r.a.createElement(se,{role:o.state.role,userId:o.state.uid})}}),r.a.createElement(p.a,{path:f.routes.dash.viewData,render:function(){return r.a.createElement(he,{role:o.state.role,uid:o.state.uid,org:o.state.org})}})],d=[r.a.createElement(p.a,{exact:!0,path:f.routes.dash.base,render:function(){return r.a.createElement(se,{role:o.state.role,userId:o.state.uid})}}),r.a.createElement(p.a,{path:f.routes.dash.viewData,render:function(){return r.a.createElement(he,{role:o.state.role,uid:o.state.uid,org:o.state.org})}})],v=[r.a.createElement(p.a,{path:f.routes.dash.bucksLanding,render:function(){return r.a.createElement(re,{username:o.state.username})}}),r.a.createElement(p.a,{path:f.routes.dash.manageAccount,component:z}),r.a.createElement(p.a,{path:f.routes.dash.base,render:function(){return r.a.createElement(he,{role:o.state.role,uid:o.state.uid,org:o.state.org})}}),r.a.createElement(p.a,{path:f.routes.dash.createBucks,render:function(){return r.a.createElement(ae,{username:o.state.username})}})],g=[r.a.createElement(p.a,{path:f.routes.dash.farmerPayout,render:function(){return r.a.createElement(ue,{username:o.state.username})}})];return"admin"===this.state.role?(e=v,a=c,t="Food Access Partnership"):"caseworker"===this.state.role?(e=d,a=s,t="Partner Organization"):"farmer"===this.state.role?(e=u,a=l,t="Farmer"):"bookkeeper"===this.state.role&&(e=g,a=i,t="Bookkeeper"),n="/dash"===this.props.location.pathname?"Scan":"/dash/manage"===this.props.location.pathname?"Manage Accounts":"/dash/BucksLanding"===this.props.location.pathname?"Create a Buck Set":"/dash/farmerPayout"===this.props.location.pathname?"Farmer Payout":"Visualizations",r.a.createElement("div",null,r.a.createElement(P.a,{basic:!0,color:"blue",inverted:!0,padded:"very"},r.a.createElement(N.a,{padded:"very",size:"huge",floated:"left"},n),r.a.createElement(E.a,Object.assign({as:N.a,floated:"right"},E.a.onlyComputer),r.a.createElement(O.a,{name:"user circle",size:"huge"}),r.a.createElement(N.a.Content,null,this.state.username,r.a.createElement(N.a.Subheader,{style:{color:"white"}},r.a.createElement(ie.a,{style:{padding:"0.3em",margin:"0"}},t)))),r.a.createElement(E.a,Object.assign({as:N.a.Subheader},E.a.onlyMobile),r.a.createElement(N.a.Content,null,this.state.username,r.a.createElement(N.a.Subheader,{style:{color:"white"}},r.a.createElement(ie.a,{style:{padding:"0.3em",margin:"0"}},t))))),r.a.createElement(de.a,{stackable:!0,secondary:!0},a,r.a.createElement(de.a.Menu,{position:"right"},r.a.createElement(de.a.Item,{name:"logout",onClick:this.handleSignOut}))),r.a.createElement(F.a,{style:{width:"100%",padding:"50px",height:"calc(100% - 220px)  !important",backgroundColor:"#eff0f3"}},r.a.createElement(h.a,null,r.a.createElement(m.a,null,e))))}}]),t}(r.a.Component),pe=(r.a.Component,function(e){function t(){return Object(s.a)(this,t),Object(i.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.authUnsub=g.a.auth().onIdTokenChanged(function(t){t?(console.log("user = ",{user:t}),t.getIdTokenResult(!0).then(function(t){console.log("idTokenResult",t.claims.role),t.claims.role&&e.props.history.push(f.routes.dash.base)})):console.log("user not defined")})}},{key:"render",value:function(){return r.a.createElement(y.a,{centered:"true"},r.a.createElement(y.a.Column,{width:6,verticalAlign:"middle",textAlign:"center"},r.a.createElement(P.a,{inverted:!0,color:"olive"},r.a.createElement(O.a,{name:"hand paper outline",size:"huge"}),r.a.createElement(N.a,{inverted:!0,as:"h1",content:"Your account is pending approval."}),r.a.createElement(N.a.Subheader,null,"Once your account is approved this page will automatically update."),r.a.createElement("p",null,"Please contact foodaccesspartnership@vigavashon.org with account inquiries."))))}}]),t}(r.a.Component)),fe=function(e){function t(){return Object(s.a)(this,t),Object(i.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(h.a,null,r.a.createElement(m.a,null,r.a.createElement(p.a,{exact:!0,path:f.routes.base,component:j}),r.a.createElement(p.a,{path:f.routes.dash.base,component:me}),r.a.createElement(p.a,{path:f.routes.createAccount,component:A}),r.a.createElement(p.a,{path:f.routes.accountRecovery,component:I}),r.a.createElement(p.a,{path:f.routes.barrier,component:pe}))))}}]),t}(n.Component),ve=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ge(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}a(593);g.a.initializeApp({apiKey:"AIzaSyArFZbAeQ5YDelr8x-lChKbUvPvo2Z7GF8",authDomain:"fapadmin-97af8.firebaseapp.com",databaseURL:"https://fapadmin-97af8.firebaseio.com",projectId:"fapadmin-97af8",storageBucket:"fapadmin-97af8.appspot.com",messagingSenderId:"766068690399"}),l.a.render(r.a.createElement(fe,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/food-access-vashon",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/food-access-vashon","/service-worker.js");ve?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ge(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):ge(t,e)})}}()}},[[324,1,2]]]);
//# sourceMappingURL=main.72ddebf0.chunk.js.map